<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Weather Dashboard with Gemini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Serene Sky (Off-white #f8f9fa, Slate Gray #495057, Sky Blue #0077b6, and a soft accent color #6c757d) -->
    <!-- Application Structure Plan: The SPA is designed as a single-view weather dashboard. The primary user flow starts with a search for a location or using the default location on load. The information is organized into three logical, hierarchical sections below the search bar: 1) 'Current Conditions' for at-a-glance information, 2) an interactive 'Hourly Forecast' chart for near-term changes, and 3) a '7-Day Forecast' for planning. This structure was chosen because it mirrors how users typically consume weather information: what is it like now, what will it be like in a few hours, and what's the outlook for the week. This avoids clutter and presents a clear narrative of the weather story. Gemini features are added to provide contextual summaries and suggestions. -->
    <!-- Visualization & Content Choices: 
    - Location Search -> Goal: Input -> Presentation: HTML Form -> Interaction: User types and submits, triggers JS fetch -> Justification: Standard, intuitive method for user input.
    - Current Conditions -> Goal: Inform -> Presentation: Styled HTML text and Unicode icons in a grid -> Interaction: Static display, updates on search -> Justification: Clear, immediate display of key metrics. Unicode icons are used to avoid SVG/image dependencies.
    - Hourly Forecast -> Goal: Show Change -> Presentation: Chart.js Line Chart in a responsive Canvas container -> Interaction: Hover tooltips show details for each hour -> Justification: A line chart is ideal for showing temperature trends over time. Chart.js is a required library.
    - Daily Forecast -> Goal: Compare -> Presentation: HTML cards in a flex/grid layout -> Interaction: Static display, clear visual separation between days -> Justification: Card-based layout allows for easy comparison of daily forecasts.
    - âœ¨ Weekly Summary (Gemini) -> Goal: Synthesize -> Presentation: Text block -> Interaction: Button click triggers Gemini API call -> Justification: Provides a human-friendly, narrative summary of the week's data.
    - âœ¨ Activity Suggestions (Gemini) -> Goal: Advise -> Presentation: Modal window -> Interaction: Button click on a daily card triggers Gemini API call -> Justification: Offers actionable, context-aware advice to the user.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .weather-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .weather-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .loader, .gemini-loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0077b6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        .gemini-loader {
            width: 24px;
            height: 24px;
            border-width: 3px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal {
            transition: opacity 0.25s ease;
        }
        .modal-content {
            transition: transform 0.25s ease;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="app" class="container mx-auto p-4 md:p-8 max-w-6xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-700">Weather Dashboard</h1>
            <p class="text-gray-500 mt-2">Get real-time weather forecasts for any location, with AI-powered insights</p>
        </header>

        <section id="search-section" class="mb-8">
            <form id="weather-form" class="max-w-xl mx-auto flex">
                <input type="text" id="location-input" placeholder="Enter a city name..." class="w-full p-3 rounded-l-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold p-3 rounded-r-lg transition">Search</button>
            </form>
            <div id="error-message" class="text-center text-red-500 mt-2 font-medium"></div>
        </section>

        <main id="weather-display" class="hidden">
            <div id="loader" class="loader"></div>
            <div id="weather-content" class="space-y-12 opacity-0 transition-opacity duration-500">
                
                <section id="current-conditions">
                    <h2 class="text-2xl font-bold mb-1 text-gray-700" id="location-name"></h2>
                    <p class="text-gray-500 mb-4">An overview of the current weather. This section provides at-a-glance information including temperature, what the weather feels like, and general conditions.</p>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                        <div class="bg-white p-6 rounded-lg shadow-md weather-card">
                            <div class="text-6xl mb-2" id="current-icon"></div>
                            <div class="text-lg font-semibold text-gray-700" id="current-description"></div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md weather-card flex flex-col justify-center">
                            <div class="text-5xl font-bold text-blue-600" id="current-temp"></div>
                            <div class="text-gray-500">Temperature</div>
                        </div>
                         <div class="bg-white p-6 rounded-lg shadow-md weather-card flex flex-col justify-center">
                            <div class="text-3xl font-bold text-gray-700" id="current-wind"></div>
                            <div class="text-gray-500 mt-1">Wind Speed</div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md weather-card flex flex-col justify-center">
                            <div class="text-3xl font-bold text-gray-700" id="current-humidity"></div>
                             <div class="text-gray-500 mt-1">Humidity</div>
                        </div>
                    </div>
                </section>

                <section id="hourly-forecast">
                    <h2 class="text-2xl font-bold mb-1 text-gray-700">Hourly Forecast</h2>
                    <p class="text-gray-500 mb-4">A visual representation of the temperature changes over the next 24 hours. Hover over the chart to see the specific temperature for any given hour.</p>
                    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
                        <div class="chart-container">
                             <canvas id="hourly-chart"></canvas>
                        </div>
                    </div>
                </section>

                <section id="daily-forecast">
                     <div class="flex flex-wrap items-center justify-between mb-4 gap-2">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-700">7-Day Forecast</h2>
                            <p class="text-gray-500">The weather outlook for the upcoming week.</p>
                        </div>
                        <button id="gemini-summary-button" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition flex items-center gap-2">
                            âœ¨ Get Weekly Summary
                        </button>
                     </div>
                     <div id="gemini-summary-container" class="hidden bg-white p-4 rounded-lg shadow-md mb-4"></div>
                     <div id="daily-cards-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-7 gap-4"></div>
                </section>
            </div>
        </main>
    </div>

    <!-- Gemini Modal -->
    <div id="gemini-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-md p-6 transform scale-95">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-700">âœ¨ Activity Suggestions</h3>
                <button id="close-modal-button" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <div id="modal-body"></div>
        </div>
    </div>


<script>
    const weatherForm = document.getElementById('weather-form');
    const locationInput = document.getElementById('location-input');
    const errorMessage = document.getElementById('error-message');
    
    const weatherDisplay = document.getElementById('weather-display');
    const loader = document.getElementById('loader');
    const weatherContent = document.getElementById('weather-content');

    const locationNameEl = document.getElementById('location-name');
    const currentIconEl = document.getElementById('current-icon');
    const currentDescriptionEl = document.getElementById('current-description');
    const currentTempEl = document.getElementById('current-temp');
    const currentWindEl = document.getElementById('current-wind');
    const currentHumidityEl = document.getElementById('current-humidity');
    const dailyCardsContainer = document.getElementById('daily-cards-container');
    
    const hourlyChartCanvas = document.getElementById('hourly-chart');
    let hourlyChart = null;
    let fullDailyData = null; 
    let currentLocation = '';

    const geminiSummaryButton = document.getElementById('gemini-summary-button');
    const geminiSummaryContainer = document.getElementById('gemini-summary-container');
    const geminiModal = document.getElementById('gemini-modal');
    const modalBody = document.getElementById('modal-body');
    const closeModalButton = document.getElementById('close-modal-button');

    const WMO_CODES = {
        0: { description: "Clear sky", icon: "â˜€ï¸" },
        1: { description: "Mainly clear", icon: "ðŸŒ¤ï¸" },
        2: { description: "Partly cloudy", icon: "â›…" },
        3: { description: "Overcast", icon: "â˜ï¸" },
        45: { description: "Fog", icon: "ðŸŒ«ï¸" },
        48: { description: "Depositing rime fog", icon: "ðŸŒ«ï¸" },
        51: { description: "Light drizzle", icon: "ðŸŒ§ï¸" },
        53: { description: "Moderate drizzle", icon: "ðŸŒ§ï¸" },
        55: { description: "Dense drizzle", icon: "ðŸŒ§ï¸" },
        61: { description: "Slight rain", icon: "ðŸŒ§ï¸" },
        63: { description: "Moderate rain", icon: "ðŸŒ§ï¸" },
        65: { description: "Heavy rain", icon: "ðŸŒ§ï¸" },
        80: { description: "Slight rain showers", icon: "ðŸŒ¦ï¸" },
        81: { description: "Moderate rain showers", icon: "ðŸŒ¦ï¸" },
        82: { description: "Violent rain showers", icon: "ðŸŒ¦ï¸" },
        95: { description: "Thunderstorm", icon: "â›ˆï¸" },
        96: { description: "Thunderstorm with slight hail", icon: "â›ˆï¸" },
        99: { description: "Thunderstorm with heavy hail", icon: "â›ˆï¸" }
    };

    function getWeatherInfo(code) {
        return WMO_CODES[code] || { description: "Unknown", icon: "ðŸ¤·" };
    }

    async function callGeminiAPI(prompt) {
        const apiKey = "AIzaSyAbIwWe0ZahSqnChDds8gRIyhQK1YU48VE"; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
        
        const payload = {
            contents: [{ role: "user", parts: [{ text: prompt }] }]
        };

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            if (!response.ok) {
                const errorBody = await response.json();
                console.error("Gemini API Error:", errorBody);
                throw new Error(`API Error: ${errorBody.error.message}`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0) {
                return result.candidates[0].content.parts[0].text;
            } else {
                throw new Error("No content received from Gemini API.");
            }
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            return `Error: Could not retrieve suggestions. ${error.message}`;
        }
    }

    async function fetchWeather(location) {
        weatherDisplay.classList.remove('hidden');
        weatherContent.classList.add('opacity-0');
        loader.style.display = 'block';
        errorMessage.textContent = '';
        geminiSummaryContainer.classList.add('hidden');

        try {
            const geoResponse = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(location)}&count=1&language=en&format=json`);
            const geoData = await geoResponse.json();

            if (!geoData.results || geoData.results.length === 0) throw new Error("Location not found. Please try another search.");
            
            const { latitude, longitude, name, admin1, country } = geoData.results[0];
            currentLocation = admin1 ? `${name}, ${admin1}, ${country}` : `${name}, ${country}`;
            
            const weatherParams = `latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&hourly=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto`;
            const weatherResponse = await fetch(`https://api.open-meteo.com/v1/forecast?${weatherParams}`);
            const weatherData = await weatherResponse.json();

            if (weatherData.error) throw new Error(weatherData.reason);
            
            fullDailyData = weatherData.daily;
            updateUI(weatherData, currentLocation);

        } catch (error) {
            errorMessage.textContent = error.message;
            weatherDisplay.classList.add('hidden');
        } finally {
            loader.style.display = 'none';
            weatherContent.classList.remove('opacity-0');
        }
    }

    function updateUI(data, location) {
        locationNameEl.textContent = location;
        const currentWeatherInfo = getWeatherInfo(data.current.weather_code);
        currentIconEl.textContent = currentWeatherInfo.icon;
        currentDescriptionEl.textContent = currentWeatherInfo.description;
        currentTempEl.innerHTML = `${Math.round(data.current.temperature_2m)}&deg;C`;
        currentWindEl.textContent = `${data.current.wind_speed_10m} km/h`;
        currentHumidityEl.textContent = `${data.current.relative_humidity_2m}%`;

        updateHourlyChart(data.hourly);
        updateDailyForecast(data.daily);
    }
    
    function updateHourlyChart(hourlyData) {
        if (hourlyChart) hourlyChart.destroy();
        const now = new Date();
        const nowIndex = hourlyData.time.findIndex(t => new Date(t) >= now);
        const labels = hourlyData.time.slice(nowIndex, nowIndex + 24).map(t => new Date(t).getHours() + ':00');
        const temps = hourlyData.temperature_2m.slice(nowIndex, nowIndex + 24);

        hourlyChart = new Chart(hourlyChartCanvas, {
            type: 'line',
            data: {
                labels,
                datasets: [{
                    label: 'Temperature (Â°C)',
                    data: temps,
                    fill: true,
                    backgroundColor: 'rgba(0, 119, 182, 0.2)',
                    borderColor: 'rgb(0, 119, 182)',
                    tension: 0.3,
                    pointBackgroundColor: 'rgb(0, 119, 182)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: { callback: value => value + 'Â°C' }
                    },
                    x: { grid: { display: false } }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: { callbacks: { label: context => `Temp: ${context.parsed.y}Â°C` } }
                }
            }
        });
    }

    function updateDailyForecast(dailyData) {
        dailyCardsContainer.innerHTML = '';
        for (let i = 0; i < 7; i++) {
            const date = new Date(dailyData.time[i]);
            const day = i === 0 ? "Today" : date.toLocaleDateString('en-US', { weekday: 'short' });
            const weatherInfo = getWeatherInfo(dailyData.weather_code[i]);
            const card = `
                <div class="bg-white p-4 rounded-lg shadow-md text-center weather-card flex flex-col justify-between">
                    <div>
                        <p class="font-bold text-gray-700">${day}</p>
                        <div class="text-4xl my-2">${weatherInfo.icon}</div>
                        <p class="text-sm text-gray-500">${weatherInfo.description}</p>
                        <div class="mt-2 font-semibold">
                            <span class="text-blue-600">${Math.round(dailyData.temperature_2m_max[i])}&deg;</span>
                            <span class="text-gray-400">/ ${Math.round(dailyData.temperature_2m_min[i])}&deg;</span>
                        </div>
                    </div>
                    <button data-day-index="${i}" class="gemini-activity-button mt-4 bg-green-500 hover:bg-green-600 text-white text-xs font-bold py-1 px-2 rounded-lg transition">âœ¨ Suggest Activities</button>
                </div>`;
            dailyCardsContainer.innerHTML += card;
        }
    }

    async function handleWeeklySummary() {
        geminiSummaryButton.disabled = true;
        geminiSummaryContainer.innerHTML = '<div class="gemini-loader"></div>';
        geminiSummaryContainer.classList.remove('hidden');

        let forecastString = "";
        for (let i = 0; i < 7; i++) {
            const date = new Date(fullDailyData.time[i]);
            const day = date.toLocaleDateString('en-US', { weekday: 'long' });
            const weatherInfo = getWeatherInfo(fullDailyData.weather_code[i]);
            forecastString += `${day}: ${weatherInfo.description}, High ${Math.round(fullDailyData.temperature_2m_max[i])}Â°C, Low ${Math.round(fullDailyData.temperature_2m_min[i])}Â°C.\n`;
        }

        const today = new Date();
        const todayString = today.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        const prompt = `You are a friendly local weather forecaster. Today is ${todayString}. Based on the following 7-day forecast data for ${currentLocation}, write a short, conversational, and helpful summary for someone planning their week. Be encouraging and focus on the key weather patterns. Keep it to one or two paragraphs.\n\nData:\n${forecastString}`;
        
        const summary = await callGeminiAPI(prompt);
        geminiSummaryContainer.innerHTML = summary.replace(/\n/g, '<br>');
        geminiSummaryButton.disabled = false;
    }

    async function handleActivitySuggestion(dayIndex) {
        modalBody.innerHTML = '<div class="gemini-loader"></div>';
        geminiModal.classList.remove('hidden', 'opacity-0');
        geminiModal.querySelector('.modal-content').classList.remove('scale-95');

        const date = new Date(fullDailyData.time[dayIndex]);
        const day = date.toLocaleDateString('en-US', { weekday: 'long' });
        const weatherInfo = getWeatherInfo(fullDailyData.weather_code[dayIndex]);
        const highTemp = Math.round(fullDailyData.temperature_2m_max[dayIndex]);
        const lowTemp = Math.round(fullDailyData.temperature_2m_min[dayIndex]);

        const prompt = `For the upcoming ${day} in ${currentLocation}, the forecast is: "${weatherInfo.description}" with a high of ${highTemp}Â°C and a low of ${lowTemp}Â°C. Suggest 3-4 suitable indoor and outdoor activities. For each suggestion, provide a brief, one-sentence reason why it's a good fit for the weather. Format the response with clear headings for 'Outdoor Activities' and 'Indoor Activities'.`;

        const suggestions = await callGeminiAPI(prompt);
        modalBody.innerHTML = suggestions.replace(/\n/g, '<br>');
    }

    weatherForm.addEventListener('submit', e => {
        e.preventDefault();
        const location = locationInput.value.trim();
        if (location) fetchWeather(location);
        else errorMessage.textContent = "Please enter a location.";
    });

    geminiSummaryButton.addEventListener('click', handleWeeklySummary);
    
    dailyCardsContainer.addEventListener('click', e => {
        if (e.target && e.target.classList.contains('gemini-activity-button')) {
            const dayIndex = e.target.getAttribute('data-day-index');
            handleActivitySuggestion(dayIndex);
        }
    });

    closeModalButton.addEventListener('click', () => {
        geminiModal.classList.add('opacity-0');
        geminiModal.querySelector('.modal-content').classList.add('scale-95');
        setTimeout(() => geminiModal.classList.add('hidden'), 250);
    });

    window.addEventListener('load', () => fetchWeather('Bhubaneswar'));

</script>
</body>
</html>
